## Day05- Handlers, User-data , Resource limit
# Ansible --> Handler to Restart Nginx

---
- name: Manage Nginx
  hosts: all                         # Connect to all server in the hosts:all group
  become:yes                         # run all command using sudo

  tasks:
    - name: Update config file
      copy:
        src: index-.html             # this file must be exist on local machine 
        dest: /usr/share/nginx/html/index.html   # This replaces the existing Nginx homepage 
      notify: Restart Nginx          # A handler will run only if this task make a changes

  handlers:                          # handlers sections--> Action trigger by notify 
    - name: Restart Nginx            # systemctl restart Nginx if the copy task above change the file 
      service:
        name: nginx
        state: restarted




## Terraform--> EC2 with User data (c6a.12xlarge)

resource "aws_instance" "PathnexEC2" {
  ami = "ami-abc9013267544wer"
  instance_type = "c6a.12xlarge"
  
  user_data = <<EOF                 # user_data --> boot script
  #!/bin/bash
  yum install -y httpd            #install the apache web server (httpd)
  systemctl start httpd           #start the web server meaning this EC2 will become webserver immediately
  EOF

    tags = {
      Name = "Pathnex-EC2"
    }
} 


## Kubernetes--> Resource Limit

apiVersion: v1
kind: pod
metadata: 
  name: pathnex-limited-pod
spec:
  containers:
    - name: app
      image: nginx
      resources:
        limits:
          memory: "256Mi"
          cpu: "500m"



## Jenkins Pipeline--> Use environmental variable 

pipeline {
    agent any                 # Run this pipeline on any available jenkins agents
    environment {             # Created a environment variable that is available in all stages 
        INSTITUTE_NAME = "Pathnex"
    }
    stages {
        stage('Print') {
            steps {
                sh 'echo "Welcome to $INSTITUTE_NAME devops training" '
            
            }
        stage('Build') {
            steps {
                sh 'mvn clean package -Dinstitute.name=$INSTITUTE_NAME'
            }
        }    
        }
    }
}


## Gitlab CI--> use environment variable 

stages:
  - build


variables:
  INSTITUTE_NAME: "Pathnex"

build:
  stage: build
  image: maven:3.8.1-jdk-17
  script:
    - git clone https://github.com/Pathnex/sample-java-app.git
    - cd sample-java-app
    - echo "Welcome to $INSTITUTE_NAME devops training"
    - mvn clean package -Dinstitute.name=$INSTITUTE_NAME

